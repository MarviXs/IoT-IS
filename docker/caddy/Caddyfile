# Redirect HTTP to HTTPS, except for MQTT domain
http:// {
    @mqtt {
        host {$MQTT_DOMAIN}
    }
    redir @mqtt http://{host}{uri}
    redir https://{host}{uri}
}

# Proxy for the frontend (port 9000)
https://{$FRONTEND_DOMAIN} {
    reverse_proxy frontend:80
}

# Proxy for the backend (port 5097)
https://{$BACKEND_DOMAIN} {
    reverse_proxy backend:5097
}

# Proxy for MQTT broker (port 1883)
http://{$MQTT_DOMAIN} {
    reverse_proxy emqx:1883
}